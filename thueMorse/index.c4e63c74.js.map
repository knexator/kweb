{"mappings":"A,I,E,A,a,O,W,W,A,a,O,K,K,A,a,O,O,O,A,a,O,O,O,C,E,E,C,E,E,C,E,E,E,iB,O,I,A,C,E,S,C,E,G,K,E,O,C,C,E,C,Q,G,K,E,C,I,E,C,C,E,A,Q,C,C,E,C,I,E,C,G,E,Q,C,C,E,O,C,C,E,C,E,E,K,E,Q,E,E,S,E,O,C,I,E,A,M,uB,E,I,O,E,K,mB,C,C,E,S,S,C,C,C,E,C,C,E,C,C,E,E,kB,G,I,E,E,QEoBO,OAAM,EACT,YACW,EAAY,CAAG,CACf,EAAY,CAAG,CACxB,CAFS,IAAA,CAAA,EAAA,EACA,IAAA,CAAA,EAAA,CACP,C,O,C,C,C,A,C,KAGG,IAAA,CAAA,IAAM,IAAI,EAAK,EAAG,E,C,G,A,Q,C,C,C,A,C,KAClB,IAAA,CAAA,KAAO,IAAI,EAAK,EAAG,E,C,G,A,Q,C,C,C,A,C,KACnB,IAAA,CAAA,KAAO,IAAI,EAAK,EAAG,E,C,G,A,Q,C,C,C,A,C,KACnB,IAAA,CAAA,KAAO,IAAI,EAAK,EAAG,E,C,G,A,Q,C,C,C,A,C,KAEnB,IAAA,CAAA,KAAO,IAAI,EAAK,EAAG,E,C,G,A,Q,C,C,C,A,C,KACnB,IAAA,CAAA,IAAM,IAAI,EAAK,EAAG,E,C,G,AAEzB,QAAO,KAAK,CAAO,CAAE,CAAU,CAAQ,CAInC,MAFA,AADA,CAAA,EAAM,GAAO,IAAI,CAAjB,EACI,EAAI,EAAE,EACV,EAAI,EAAI,EAAE,EACH,CACX,CAEA,OAAO,IAAI,CAAO,CAAE,CAAO,CAAE,CAAU,CAAQ,CAI3C,MAFA,AADA,CAAA,EAAM,GAAO,IAAI,CAAjB,EACI,EAAI,EAAE,EAAI,EAAE,EAChB,EAAI,EAAI,EAAE,EAAI,EAAE,EACT,CACX,CAEA,OAAO,IAAI,CAAO,CAAE,CAAO,CAAE,CAAU,CAAQ,CAI3C,MAFA,AADA,CAAA,EAAM,GAAO,IAAI,CAAjB,EACI,EAAI,EAAE,EAAI,EAAE,EAChB,EAAI,EAAI,EAAE,EAAI,EAAE,EACT,CACX,CAEA,OAAO,OAAO,CAAO,CAAE,CAAU,CAAQ,CAIrC,MAFA,AADA,CAAA,EAAM,GAAO,IAAI,CAAjB,EACI,EAAI,CAAC,EAAE,EACX,EAAI,EAAI,CAAC,EAAE,EACJ,CACX,CAEA,OAAO,MAAM,CAAO,CAAE,CAAS,CAAE,CAAU,CAAQ,CAI/C,MAFA,AADA,CAAA,EAAM,GAAO,IAAI,CAAjB,EACI,EAAI,EAAE,EAAI,EACd,EAAI,EAAI,EAAE,EAAI,EACP,CACX,CAEA,OAAO,KAAK,CAAO,CAAE,CAAO,CAAE,CAAS,CAAE,CAAU,CAAQ,CAIvD,MAFA,AADA,CAAA,EAAM,GAAO,IAAI,CAAjB,EACI,EAAI,EAAE,EAAK,CAAA,EAAI,CAAA,EAAK,EAAE,EAAI,EAC9B,EAAI,EAAI,EAAE,EAAK,CAAA,EAAI,CAAA,EAAK,EAAE,EAAI,EACvB,CACX,CAEA,OAAO,OAAO,CAAO,CAAW,CAC5B,OAAO,AAAO,GAAP,EAAE,GAAU,AAAO,GAAP,EAAE,CACzB,CAEA,OAAO,OAAO,CAAO,CAAE,CAAO,CAAW,CACrC,OAAO,EAAE,GAAK,EAAE,GAAK,EAAE,GAAK,EAAE,CAClC,CAEA,OAAO,KAAK,CAAO,CAAE,CAAO,CAAE,CAAoC,CAAE,CAAU,CAAQ,CAIlF,MAFA,AADA,CAAA,EAAM,GAAO,IAAI,CAAjB,EACI,EAAI,EAAG,EAAE,EAAG,EAAE,GAClB,EAAI,EAAI,EAAG,EAAE,EAAG,EAAE,GACX,CACX,CACJ,CDxFA,MAAM,EAAS,SAAS,cAAc,MAChC,EAAM,EAAO,WAAW,MAEhB,sBA8Od,SAAS,EAAO,CAAgB,MClPX,EAAW,EAAW,EAAtB,EAAW,EAAW,EDmPvC,EAAA,0BAA+B,GAE/B,IAAI,EAAQ,AAAC,CAAA,EAAW,CAAA,EAAa,KACrC,EAAY,EAEZ,EAAI,UAAY,UAChB,EAAI,SAAS,EAAG,EAAG,EAAO,MAAO,EAAO,QAExC,GAAU,EAtNQ,GAuNlB,EAAS,KAAK,IAAI,EAAK,GAIvB,IAAI,EAAI,EAAO,MACX,EAAI,EAAO,OAEX,ICnQa,EDoQJ,AAAI,EAAJ,ECpQe,EDoQR,EAAhB,ECnQG,EAAK,CAAA,GAD2B,EDoQhB,ECnQP,EAAK,EAAI,EADR,EDsQJ,AAAI,EAAJ,ECtQe,EDsQR,EAAhB,ECrQG,EAAK,CAAA,GAD2B,EDsQhB,ECrQP,EAAK,EAAI,GD0QzB,AApFJ,SAAS,EAAY,CAAS,CAAE,CAAS,CAAE,CAAS,CAAE,CAAS,CAAE,CAAiB,CAAE,CAAa,EAC7F,GAAI,EAAQ,OAAS,EAAe,OAAQ,CAExC,IAAI,EAAK,EACL,EAAK,EAAI,EAAI,EAEb,EAAK,EAAI,EAAI,EAYjB,GAVI,IACA,EAAK,EAAI,EAAI,EACb,EAAK,GAGT,EAAY,EARH,EAQW,EAAI,EAAG,EAAI,EAAG,EAAQ,OAAO,CAAC,EAAE,EAAG,GACvD,EAAY,EATH,EASW,EAAI,EAAG,EAAI,EAAG,EAAQ,OAAO,CAAC,EAAE,EAAG,CAAC,GACxD,EAAY,EAAI,EAAI,EAAI,EAAG,EAAI,EAAG,EAAQ,OAAO,CAAC,EAAE,EAAG,CAAC,GACxD,EAAY,EAAI,EAAI,EAAI,EAAG,EAAI,EAAG,EAAQ,OAAO,CAAC,EAAE,EAAG,GAEnD,AAAwB,GAAxB,EAAY,GAAe,CAE3B,IAAI,EAAS,EAAO,EAAiB,CACrC,CAAA,EAAI,UAAY,CAAM,CAAC,EAAE,CACzB,IAAI,EAAS,EAAI,CAEgC,CAAA,GAA7C,CAAc,CAAC,EAAe,OAAS,EAAE,EACrC,CAAA,AAAC,EAED,AAAyD,GAAzD,EAAY,EAAS,CAAC,EAAE,CAAC,OAAO,IADhC,AAA6C,GAA7C,EAAY,EAAS,EACoC,GAE7D,CAAA,GAAU,CAFkB,EAIhC,EAAY,EAAG,EAAG,EAAG,EAAG,EAC5B,CACJ,KAAO,CAEH,IAAI,EAAS,EAAO,EAAiB,EAEjC,EAAW,EAAY,EACX,CAAA,GAAZ,IACA,EAAI,UAAY,CAAM,CAAC,EAAE,CACzB,EAAI,SAAS,EAAG,EAAG,EAAG,GACtB,EAAI,UAAY,CAAM,CAAC,EAAE,CACzB,EAAY,EAAG,EAAG,EAAG,EAAG,EAAI,IAEhB,GAAZ,IACA,EAAI,UAAY,CAAM,CAAC,EAAE,CACzB,EAAY,EAAG,EAAG,EAAG,EAAG,EAAI,GAEpC,CACJ,EAsBY,EACA,EAYU,EAAG,EAAG,EAAE,CAAE,CAAA,GAOxB,IACA,EAAI,UAAY,OAChB,EAAI,UAAY,SAChB,EAAI,aAAe,SACnB,EAAI,KAAO,aACX,EAAI,SAAS,iBAAkB,EAAO,MAAQ,EAAG,AAAgB,EAAhB,EAAO,OAAa,IAG/D,sBAAsB,EACpC,GAtRA,SAAS,iBAAiB,UAI1B,SAAmB,CAAiB,EAChC,OAAQ,EAAG,MACP,IAAK,OACD,EAAQ,CAAA,GACR,KACJ,KAAK,OACD,EAAQ,CAAA,EAIhB,CACJ,GAbA,SAAS,iBAAiB,QAgB1B,SAAiB,CAAc,EACvB,EACA,EAAgB,CAAA,EAEhB,EAAQ,EAAG,MAAQ,OAAO,WAAa,EAE/C,GAPA,IAAI,EAAgB,CAAA,EAShB,EAAW,EACX,EAAsB,CAAC,EAAE,CACzB,EAAiB,CAAC,EAAE,CACpB,EAAY,CAAA,EAEZ,EAAS,EA4Cb,SAAS,EAAQ,CAAgB,EAC7B,EAAS,EACL,GAAW,AA1CnB,SAAmB,CAAS,EACxB,IAAI,EAAM,CAAA,EACV,KAAO,EAAI,GACH,EAAI,GAAK,GACT,CAAA,EAAM,CAAC,CADX,EAGA,IAAS,EAEb,OAAO,CACX,EAiC6B,IACrB,GAAY,EACZ,EAAY,EAAe,MAAM,AAAA,GAAK,AAAK,GAAL,GACtC,EAAsB,EAAe,QACrC,EAAiB,AAvBzB,SAAoB,CAAiB,EACjC,GAAI,EAAQ,MAAM,AAAA,GAAK,AAAK,GAAL,GAAS,CAC5B,IAAI,EAAS,MAAM,EAAQ,OAAS,GAAG,KAAK,GAE5C,OADA,CAAM,CAAC,EAAE,CAAG,EACL,CACX,CACA,IAAI,EAAS,EAAQ,QACrB,IAAK,IAAI,EAAI,EAAO,OAAS,EAAG,GAAK,EAAG,IAAK,CACzC,GAAI,AAAc,IAAd,CAAM,CAAC,EAAE,CAET,OADA,CAAM,CAAC,EAAE,EAAI,EACN,CAEX,CAAA,CAAM,CAAC,EAAE,CAAG,CAChB,CACA,MAAM,AAAI,MAAM,MACpB,EAQoC,GAC5B,QAAQ,IAAI,SAAU,GACtB,QAAQ,IAAI,QAAS,KAGrB,MAAM,CAAC,OAAO,EAAE,EAAS,CAAC,EAC1B,EAAW,EACX,EAAY,CAAA,EACZ,EAAiB,CAAC,EAAE,CAE5B,CAEA,SAAS,EAAY,CAAiB,CAAE,CAAiB,EACrD,EAAS,GAAU,EACnB,IAAK,IAAI,EAAI,EAAG,EAAI,KAAK,IAAI,EAAQ,OAAQ,EAAO,QAAS,IAAK,CAC9D,GAAI,CAAO,CAAC,EAAE,CAAG,CAAM,CAAC,EAAE,CACtB,OAAO,EACJ,GAAI,CAAO,CAAC,EAAE,CAAG,CAAM,CAAC,EAAE,CAC7B,OAAO,CAEf,CACA,OAAO,CACX,CA0BA,MAAM,EAAiB,CAAC,MAAO,OAAQ,UAAU,CAC3C,EAAkB,CAAC,QAAS,OAAQ,YAAY,CAmGtD,SAAS,EAAY,CAAS,CAAE,CAAS,CAAE,CAAS,CAAE,CAAS,CAAE,CAAc,EAC3E,EAAI,SAAS,EAAG,EAAG,EAAG,GACtB,EAAI,SAAS,EAAG,EAAI,EAAI,EAAQ,EAAG,GACnC,EAAI,SAAS,EAAG,EAAG,EAAQ,GAC3B,EAAI,SAAS,EAAI,EAAI,EAAQ,EAAG,EAAQ,EAC5C,CAEA,IAAI,EAAY","sources":["<anon>","thueMorse/main.ts","kommon/math.ts"],"sourcesContent":["var $parcel$global =\ntypeof globalThis !== 'undefined'\n  ? globalThis\n  : typeof self !== 'undefined'\n  ? self\n  : typeof window !== 'undefined'\n  ? window\n  : typeof global !== 'undefined'\n  ? global\n  : {};\nvar $parcel$modules = {};\nvar $parcel$inits = {};\n\nvar parcelRequire = $parcel$global[\"parcelRequire94c2\"];\nif (parcelRequire == null) {\n  parcelRequire = function(id) {\n    if (id in $parcel$modules) {\n      return $parcel$modules[id].exports;\n    }\n    if (id in $parcel$inits) {\n      var init = $parcel$inits[id];\n      delete $parcel$inits[id];\n      var module = {id: id, exports: {}};\n      $parcel$modules[id] = module;\n      init.call(module.exports, module, module.exports);\n      return module.exports;\n    }\n    var err = new Error(\"Cannot find module '\" + id + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n  };\n\n  parcelRequire.register = function register(id, init) {\n    $parcel$inits[id] = init;\n  };\n\n  $parcel$global[\"parcelRequire94c2\"] = parcelRequire;\n}\n\nvar $amYBK = parcelRequire(\"amYBK\");\n// Use objects instead of arrays: https://jsben.ch/FgKVi\nfunction $5c4293b9a464b6e0$export$3a89f8d6f6bf6c9f(a, b, t) {\n    return a * (1 - t) + b * t;\n}\nfunction $5c4293b9a464b6e0$export$dff840edf10f285e(cur, target, max_delta) {\n    if (cur > target) return Math.max(cur - max_delta, target);\n    else if (cur < target) return Math.min(cur + max_delta, target);\n    else return target;\n}\nfunction $5c4293b9a464b6e0$export$7d15b64cf5a3a4c4(value, min, max) {\n    return Math.max(min, Math.min(max, value));\n}\nclass $5c4293b9a464b6e0$export$ac4bca90992eed1 {\n    constructor(x = 0.0, y = 0.0){\n        this.x = x;\n        this.y = y;\n    }\n    static #_ = (()=>{\n        // scratchpad vectors, meant to be reused as intermediate values without allocation\n        this.tmp = new $5c4293b9a464b6e0$export$ac4bca90992eed1(0, 0);\n    })();\n    static #_1 = (()=>{\n        this.tmp1 = new $5c4293b9a464b6e0$export$ac4bca90992eed1(0, 0);\n    })();\n    static #_2 = (()=>{\n        this.tmp2 = new $5c4293b9a464b6e0$export$ac4bca90992eed1(0, 0);\n    })();\n    static #_3 = (()=>{\n        this.tmp3 = new $5c4293b9a464b6e0$export$ac4bca90992eed1(0, 0);\n    })();\n    static #_4 = (()=>{\n        this.zero = new $5c4293b9a464b6e0$export$ac4bca90992eed1(0, 0);\n    })();\n    static #_5 = (()=>{\n        this.one = new $5c4293b9a464b6e0$export$ac4bca90992eed1(1, 1);\n    })();\n    static copy(v, out) {\n        out = out || new $5c4293b9a464b6e0$export$ac4bca90992eed1();\n        out.x = v.x;\n        out.y = v.y;\n        return out;\n    }\n    static add(a, b, out) {\n        out = out || new $5c4293b9a464b6e0$export$ac4bca90992eed1();\n        out.x = a.x + b.x;\n        out.y = a.y + b.y;\n        return out;\n    }\n    static sub(a, b, out) {\n        out = out || new $5c4293b9a464b6e0$export$ac4bca90992eed1();\n        out.x = a.x - b.x;\n        out.y = a.y - b.y;\n        return out;\n    }\n    static negate(v, out) {\n        out = out || new $5c4293b9a464b6e0$export$ac4bca90992eed1();\n        out.x = -v.x;\n        out.y = -v.y;\n        return out;\n    }\n    static scale(v, s, out) {\n        out = out || new $5c4293b9a464b6e0$export$ac4bca90992eed1();\n        out.x = v.x * s;\n        out.y = v.y * s;\n        return out;\n    }\n    static lerp(a, b, t, out) {\n        out = out || new $5c4293b9a464b6e0$export$ac4bca90992eed1();\n        out.x = a.x * (1 - t) + b.x * t;\n        out.y = a.y * (1 - t) + b.y * t;\n        return out;\n    }\n    static isZero(v) {\n        return v.x == 0 && v.y == 0;\n    }\n    static equals(a, b) {\n        return a.x == b.x && a.y == b.y;\n    }\n    static map2(a, b, fn, out) {\n        out = out || new $5c4293b9a464b6e0$export$ac4bca90992eed1();\n        out.x = fn(a.x, b.x);\n        out.y = fn(a.y, b.y);\n        return out;\n    }\n}\n\n\nconst $b7c86ab12e2a3969$var$canvas = document.querySelector(\"#c\");\nconst $b7c86ab12e2a3969$var$ctx = $b7c86ab12e2a3969$var$canvas.getContext(\"2d\");\nlet $b7c86ab12e2a3969$var$loop_id = requestAnimationFrame($b7c86ab12e2a3969$var$update);\ndocument.addEventListener(\"keydown\", $b7c86ab12e2a3969$var$onKeyDown);\n// document.addEventListener(\"keyup\", onKeyUp);\ndocument.addEventListener(\"click\", $b7c86ab12e2a3969$var$onClick);\nfunction $b7c86ab12e2a3969$var$onKeyDown(ev) {\n    switch(ev.code){\n        case \"KeyA\":\n            $b7c86ab12e2a3969$var$onInput(true);\n            break;\n        case \"KeyD\":\n            $b7c86ab12e2a3969$var$onInput(false);\n            break;\n        default:\n            break;\n    }\n}\nlet $b7c86ab12e2a3969$var$pending_click = true;\nfunction $b7c86ab12e2a3969$var$onClick(ev) {\n    if ($b7c86ab12e2a3969$var$pending_click) $b7c86ab12e2a3969$var$pending_click = false;\n    else $b7c86ab12e2a3969$var$onInput(ev.pageX < window.innerWidth / 2);\n}\nlet $b7c86ab12e2a3969$var$cur_turn = 0;\nlet $b7c86ab12e2a3969$var$prev_player_address = [\n    0\n];\nlet $b7c86ab12e2a3969$var$player_address = [\n    0\n];\nlet $b7c86ab12e2a3969$var$anim_turn = false;\n/** between 0 & 1 */ let $b7c86ab12e2a3969$var$anim_t = 0.0;\nconst $b7c86ab12e2a3969$var$anim_duration = .3;\n// starts as true;\nfunction $b7c86ab12e2a3969$var$thueMorse(n) {\n    let res = true;\n    while(n > 0){\n        if (n % 2 == 1) res = !res;\n        n = n >> 1;\n    }\n    return res;\n}\nfunction $b7c86ab12e2a3969$var$depth(n) {\n    let res = 0;\n    let cur_at_depth = 4;\n    n -= cur_at_depth;\n    while(n > 0){\n        res += 1;\n        cur_at_depth *= 4;\n        n -= cur_at_depth;\n    }\n    return res;\n}\nfunction $b7c86ab12e2a3969$var$nextAdress(address) {\n    if (address.every((d)=>d == 3)) {\n        let result = Array(address.length + 1).fill(0);\n        result[0] = 1;\n        return result;\n    }\n    let result = address.slice();\n    for(let k = result.length - 1; k >= 0; k--){\n        if (result[k] !== 3) {\n            result[k] += 1;\n            return result;\n        }\n        result[k] = 0;\n    }\n    throw new Error(\"???\");\n}\nfunction $b7c86ab12e2a3969$var$onInput(is_left) {\n    $b7c86ab12e2a3969$var$anim_t = 0;\n    if (is_left == $b7c86ab12e2a3969$var$thueMorse($b7c86ab12e2a3969$var$cur_turn)) {\n        $b7c86ab12e2a3969$var$cur_turn += 1;\n        $b7c86ab12e2a3969$var$anim_turn = $b7c86ab12e2a3969$var$player_address.every((d)=>d == 3);\n        $b7c86ab12e2a3969$var$prev_player_address = $b7c86ab12e2a3969$var$player_address.slice();\n        $b7c86ab12e2a3969$var$player_address = $b7c86ab12e2a3969$var$nextAdress($b7c86ab12e2a3969$var$player_address);\n        console.log(\"prev: \", $b7c86ab12e2a3969$var$prev_player_address);\n        console.log(\"cur: \", $b7c86ab12e2a3969$var$player_address);\n    } else {\n        // lost!\n        alert(`score: ${$b7c86ab12e2a3969$var$cur_turn}`);\n        $b7c86ab12e2a3969$var$cur_turn = 0;\n        $b7c86ab12e2a3969$var$anim_turn = false;\n        $b7c86ab12e2a3969$var$player_address = [\n            0\n        ];\n    }\n}\nfunction $b7c86ab12e2a3969$var$getVisiting(address, player) {\n    player = player || $b7c86ab12e2a3969$var$player_address;\n    for(let k = 0; k < Math.min(address.length, player.length); k++){\n        if (address[k] < player[k]) return 0;\n        else if (address[k] > player[k]) return 2;\n    }\n    return 1;\n}\nconst $b7c86ab12e2a3969$var$colors_asdf = [\n    \"#5FAD67\",\n    \"#A9F05F\",\n    \"#5889A2\"\n];\n// visiting: \"past\" | \"present\" | \"future\"\nfunction $b7c86ab12e2a3969$var$drawTiles(x, y, w, h, address, flip) {\n    if (address.length < $b7c86ab12e2a3969$var$player_address.length) {\n        // still bigger than the player, recurse more\n        let x1 = x;\n        let x2 = x + w / 2;\n        if (flip) {\n            x1 = x + w / 2;\n            x2 = x;\n        }\n        $b7c86ab12e2a3969$var$drawTiles(x1, y, w / 2, h / 4, address.concat([\n            0\n        ]), flip);\n        $b7c86ab12e2a3969$var$drawTiles(x2, y + h / 4, w / 2, h / 4, address.concat([\n            1\n        ]), !flip);\n        $b7c86ab12e2a3969$var$drawTiles(x2, y + h / 2, w / 2, h / 4, address.concat([\n            2\n        ]), !flip);\n        $b7c86ab12e2a3969$var$drawTiles(x1, y + h * .75, w / 2, h / 4, address.concat([\n            3\n        ]), flip);\n    } else {\n        // plain quad\n        let visiting = $b7c86ab12e2a3969$var$getVisiting(address);\n        $b7c86ab12e2a3969$var$ctx.fillStyle = $b7c86ab12e2a3969$var$colors_asdf[visiting];\n        $b7c86ab12e2a3969$var$ctx.fillRect(x, y, w, h);\n    }\n}\nconst $b7c86ab12e2a3969$var$colors_v2_left = [\n    \"red\",\n    \"pink\",\n    \"darkred\"\n];\nconst $b7c86ab12e2a3969$var$colors_v2_right = [\n    \"green\",\n    \"lime\",\n    \"darkgreen\"\n];\nfunction $b7c86ab12e2a3969$var$drawTilesV2(x, y, w, h, address, flip) {\n    if (address.length < $b7c86ab12e2a3969$var$player_address.length) {\n        // still bigger than the player, recurse more\n        let x1 = x;\n        let x2 = x + w / 2;\n        let y1 = y;\n        let y2 = y + h / 2;\n        $b7c86ab12e2a3969$var$drawTilesV2(x1, y1, w / 2, h / 2, address.concat([\n            0\n        ]), flip);\n        $b7c86ab12e2a3969$var$drawTilesV2(x2, y1, w / 2, h / 2, address.concat([\n            1\n        ]), !flip);\n        $b7c86ab12e2a3969$var$drawTilesV2(x1, y2, w / 2, h / 2, address.concat([\n            2\n        ]), !flip);\n        $b7c86ab12e2a3969$var$drawTilesV2(x2, y2, w / 2, h / 2, address.concat([\n            3\n        ]), flip);\n        if ($b7c86ab12e2a3969$var$getVisiting(address) == 0) {\n            // fully in the past\n            let colors = flip ? $b7c86ab12e2a3969$var$colors_v2_left : $b7c86ab12e2a3969$var$colors_v2_right;\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[1];\n            let border = w / 8;\n            if ($b7c86ab12e2a3969$var$player_address[$b7c86ab12e2a3969$var$player_address.length - 1] == 0 // has player changed square?\n             && (!$b7c86ab12e2a3969$var$anim_turn ? $b7c86ab12e2a3969$var$getVisiting(address, $b7c86ab12e2a3969$var$prev_player_address) == 1 : $b7c86ab12e2a3969$var$getVisiting(address, [\n                0\n            ].concat($b7c86ab12e2a3969$var$prev_player_address)) == 1)) border *= $b7c86ab12e2a3969$var$anim_t;\n            $b7c86ab12e2a3969$var$thickBorder(x, y, w, h, border);\n        }\n    } else {\n        // plain quad\n        let colors = flip ? $b7c86ab12e2a3969$var$colors_v2_left : $b7c86ab12e2a3969$var$colors_v2_right;\n        let visiting = $b7c86ab12e2a3969$var$getVisiting(address);\n        if (visiting == 0) {\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[0];\n            $b7c86ab12e2a3969$var$ctx.fillRect(x, y, w, h);\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[1];\n            $b7c86ab12e2a3969$var$thickBorder(x, y, w, h, w / 8);\n        }\n        if (visiting == 1) {\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[1];\n            $b7c86ab12e2a3969$var$thickBorder(x, y, w, h, w / 8);\n        }\n    }\n}\nfunction $b7c86ab12e2a3969$var$drawTilesV3(x, y, w, h, address, flip) {\n    if (address.length < $b7c86ab12e2a3969$var$player_address.length) {\n        // still bigger than the player, recurse more\n        let x1 = x;\n        let x2 = x + w / 2;\n        let y1 = y;\n        let y2 = y + h / 2;\n        if (flip) {\n            x1 = x + w / 2;\n            x2 = x;\n        }\n        $b7c86ab12e2a3969$var$drawTilesV3(x1, y1, w / 2, h / 2, address.concat([\n            0\n        ]), flip);\n        $b7c86ab12e2a3969$var$drawTilesV3(x2, y1, w / 2, h / 2, address.concat([\n            1\n        ]), !flip);\n        $b7c86ab12e2a3969$var$drawTilesV3(x2, y2, w / 2, h / 2, address.concat([\n            2\n        ]), !flip);\n        $b7c86ab12e2a3969$var$drawTilesV3(x1, y2, w / 2, h / 2, address.concat([\n            3\n        ]), flip);\n        if ($b7c86ab12e2a3969$var$getVisiting(address) == 0) {\n            // fully in the past\n            let colors = flip ? $b7c86ab12e2a3969$var$colors_v2_left : $b7c86ab12e2a3969$var$colors_v2_right;\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[1];\n            let border = w / 8;\n            if ($b7c86ab12e2a3969$var$player_address[$b7c86ab12e2a3969$var$player_address.length - 1] == 0 // has player changed square?\n             && (!$b7c86ab12e2a3969$var$anim_turn ? $b7c86ab12e2a3969$var$getVisiting(address, $b7c86ab12e2a3969$var$prev_player_address) == 1 : $b7c86ab12e2a3969$var$getVisiting(address, [\n                0\n            ].concat($b7c86ab12e2a3969$var$prev_player_address)) == 1)) border *= $b7c86ab12e2a3969$var$anim_t;\n            $b7c86ab12e2a3969$var$thickBorder(x, y, w, h, border);\n        }\n    } else {\n        // plain quad\n        let colors = flip ? $b7c86ab12e2a3969$var$colors_v2_left : $b7c86ab12e2a3969$var$colors_v2_right;\n        let visiting = $b7c86ab12e2a3969$var$getVisiting(address);\n        if (visiting == 0) {\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[0];\n            $b7c86ab12e2a3969$var$ctx.fillRect(x, y, w, h);\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[1];\n            $b7c86ab12e2a3969$var$thickBorder(x, y, w, h, w / 8);\n        }\n        if (visiting == 1) {\n            $b7c86ab12e2a3969$var$ctx.fillStyle = colors[1];\n            $b7c86ab12e2a3969$var$thickBorder(x, y, w, h, w / 8);\n        }\n    }\n}\nfunction $b7c86ab12e2a3969$var$thickBorder(x, y, w, h, border) {\n    $b7c86ab12e2a3969$var$ctx.fillRect(x, y, w, border);\n    $b7c86ab12e2a3969$var$ctx.fillRect(x, y + h - border, w, border);\n    $b7c86ab12e2a3969$var$ctx.fillRect(x, y, border, h);\n    $b7c86ab12e2a3969$var$ctx.fillRect(x + w - border, y, border, h);\n}\nlet $b7c86ab12e2a3969$var$time_last = 0;\nfunction $b7c86ab12e2a3969$var$update(time_cur) {\n    $amYBK.resizeCanvasToDisplaySize($b7c86ab12e2a3969$var$canvas);\n    let delta = (time_cur - $b7c86ab12e2a3969$var$time_last) * 0.001;\n    $b7c86ab12e2a3969$var$time_last = time_cur;\n    $b7c86ab12e2a3969$var$ctx.fillStyle = \"#4E5E5E\";\n    $b7c86ab12e2a3969$var$ctx.fillRect(0, 0, $b7c86ab12e2a3969$var$canvas.width, $b7c86ab12e2a3969$var$canvas.height);\n    $b7c86ab12e2a3969$var$anim_t += delta / $b7c86ab12e2a3969$var$anim_duration;\n    $b7c86ab12e2a3969$var$anim_t = Math.min(1.0, $b7c86ab12e2a3969$var$anim_t);\n    let x = 0;\n    let y = 0;\n    let w = $b7c86ab12e2a3969$var$canvas.width;\n    let h = $b7c86ab12e2a3969$var$canvas.height;\n    if ($b7c86ab12e2a3969$var$anim_turn) {\n        w = (0, $5c4293b9a464b6e0$export$3a89f8d6f6bf6c9f)(w * 2, w, $b7c86ab12e2a3969$var$anim_t);\n        // h = lerp(h * 4, h, anim_t); // style 1: vertical\n        h = (0, $5c4293b9a464b6e0$export$3a89f8d6f6bf6c9f)(h * 2, h, $b7c86ab12e2a3969$var$anim_t); // style 2: squares\n    }\n    // drawTiles(x, y, w, h, [], false);\n    // drawTilesV2(x, y, w, h, [], false);\n    $b7c86ab12e2a3969$var$drawTilesV3(x, y, w, h, [], false);\n    // cheat\n    // while (cur_turn < 1023) {\n    //     onInput(thueMorse(cur_turn));\n    // }\n    if ($b7c86ab12e2a3969$var$pending_click) {\n        $b7c86ab12e2a3969$var$ctx.fillStyle = \"pink\";\n        $b7c86ab12e2a3969$var$ctx.textAlign = \"center\";\n        $b7c86ab12e2a3969$var$ctx.textBaseline = \"middle\";\n        $b7c86ab12e2a3969$var$ctx.font = \"60px Arial\";\n        $b7c86ab12e2a3969$var$ctx.fillText(\"Click to start\", $b7c86ab12e2a3969$var$canvas.width / 2, $b7c86ab12e2a3969$var$canvas.height * 3 / 4);\n    }\n    $b7c86ab12e2a3969$var$loop_id = requestAnimationFrame($b7c86ab12e2a3969$var$update);\n}\n\n\n//# sourceMappingURL=index.c4e63c74.js.map\n","import * as twgl from \"twgl.js\";\r\nimport { lerp } from \"../kommon/math\";\r\n\r\nconst canvas = document.querySelector(\"#c\") as HTMLCanvasElement;\r\nconst ctx = canvas.getContext(\"2d\")!;\r\n\r\nlet loop_id = requestAnimationFrame(update);\r\ndocument.addEventListener(\"keydown\", onKeyDown);\r\n// document.addEventListener(\"keyup\", onKeyUp);\r\ndocument.addEventListener(\"click\", onClick);\r\n\r\nfunction onKeyDown(ev: KeyboardEvent) {\r\n    switch (ev.code) {\r\n        case \"KeyA\":\r\n            onInput(true);\r\n            break;\r\n        case \"KeyD\":\r\n            onInput(false);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n}\r\n\r\nlet pending_click = true;\r\nfunction onClick(ev: MouseEvent) {\r\n    if (pending_click) {\r\n        pending_click = false;\r\n    } else {\r\n        onInput(ev.pageX < window.innerWidth / 2);\r\n    }\r\n}\r\n\r\nlet cur_turn = 0;\r\nlet prev_player_address = [0];\r\nlet player_address = [0];\r\nlet anim_turn = false;\r\n/** between 0 & 1 */\r\nlet anim_t = 0.0;\r\nconst anim_duration = .3;\r\n\r\n// starts as true;\r\nfunction thueMorse(n: number) {\r\n    let res = true;\r\n    while (n > 0) {\r\n        if (n % 2 == 1) {\r\n            res = !res;\r\n        }\r\n        n = n >> 1;\r\n    }\r\n    return res;\r\n}\r\n\r\nfunction depth(n: number) {\r\n    let res = 0;\r\n    let cur_at_depth = 4;\r\n    n -= cur_at_depth;\r\n    while (n > 0) {\r\n        res += 1;\r\n        cur_at_depth *= 4;\r\n        n -= cur_at_depth;\r\n    }\r\n    return res;\r\n}\r\n\r\nfunction nextAdress(address: number[]) {\r\n    if (address.every(d => d == 3)) {\r\n        let result = Array(address.length + 1).fill(0);\r\n        result[0] = 1;\r\n        return result;\r\n    }\r\n    let result = address.slice();\r\n    for (let k = result.length - 1; k >= 0; k--) {\r\n        if (result[k] !== 3) {\r\n            result[k] += 1;\r\n            return result;\r\n        }\r\n        result[k] = 0;\r\n    }\r\n    throw new Error(\"???\");\r\n}\r\n\r\nfunction onInput(is_left: boolean) {\r\n    anim_t = 0;\r\n    if (is_left == thueMorse(cur_turn)) {\r\n        cur_turn += 1;\r\n        anim_turn = player_address.every(d => d == 3);\r\n        prev_player_address = player_address.slice();\r\n        player_address = nextAdress(player_address);\r\n        console.log(\"prev: \", prev_player_address)\r\n        console.log(\"cur: \", player_address)\r\n    } else {\r\n        // lost!\r\n        alert(`score: ${cur_turn}`)\r\n        cur_turn = 0;\r\n        anim_turn = false;\r\n        player_address = [0];\r\n    }\r\n}\r\n\r\nfunction getVisiting(address: number[], player?: number[]): 0 | 1 | 2 {\r\n    player = player || player_address;\r\n    for (let k = 0; k < Math.min(address.length, player.length); k++) {\r\n        if (address[k] < player[k]) {\r\n            return 0;\r\n        } else if (address[k] > player[k]) {\r\n            return 2;\r\n        }\r\n    }\r\n    return 1;\r\n}\r\n\r\nconst colors_asdf = [\"#5FAD67\", \"#A9F05F\", \"#5889A2\"];\r\n// visiting: \"past\" | \"present\" | \"future\"\r\nfunction drawTiles(x: number, y: number, w: number, h: number, address: number[], flip: boolean) {\r\n    if (address.length < player_address.length) {\r\n        // still bigger than the player, recurse more\r\n        let x1 = x;\r\n        let x2 = x + w / 2;\r\n        if (flip) {\r\n            x1 = x + w / 2;\r\n            x2 = x;\r\n        }\r\n\r\n        drawTiles(x1, y, w / 2, h / 4, address.concat([0]), flip);\r\n        drawTiles(x2, y + h / 4, w / 2, h / 4, address.concat([1]), !flip);\r\n        drawTiles(x2, y + h / 2, w / 2, h / 4, address.concat([2]), !flip);\r\n        drawTiles(x1, y + h * .75, w / 2, h / 4, address.concat([3]), flip);\r\n    } else {\r\n        // plain quad\r\n        let visiting = getVisiting(address);\r\n        ctx.fillStyle = colors_asdf[visiting];\r\n        ctx.fillRect(x, y, w, h);\r\n    }\r\n}\r\n\r\nconst colors_v2_left = [\"red\", \"pink\", \"darkred\"];\r\nconst colors_v2_right = [\"green\", \"lime\", \"darkgreen\"];\r\nfunction drawTilesV2(x: number, y: number, w: number, h: number, address: number[], flip: boolean) {\r\n    if (address.length < player_address.length) {\r\n        // still bigger than the player, recurse more\r\n        let x1 = x;\r\n        let x2 = x + w / 2;\r\n        let y1 = y;\r\n        let y2 = y + h / 2;\r\n\r\n        drawTilesV2(x1, y1, w / 2, h / 2, address.concat([0]), flip);\r\n        drawTilesV2(x2, y1, w / 2, h / 2, address.concat([1]), !flip);\r\n        drawTilesV2(x1, y2, w / 2, h / 2, address.concat([2]), !flip);\r\n        drawTilesV2(x2, y2, w / 2, h / 2, address.concat([3]), flip);\r\n\r\n        if (getVisiting(address) == 0) {\r\n            // fully in the past\r\n            let colors = flip ? colors_v2_left : colors_v2_right\r\n            ctx.fillStyle = colors[1];\r\n            let border = w / 8;\r\n            if (\r\n                player_address[player_address.length - 1] == 0 // has player changed square?\r\n                && (!anim_turn ?\r\n                    getVisiting(address, prev_player_address) == 1 : // did we just visit this square?\r\n                    getVisiting(address, [0].concat(prev_player_address)) == 1)) // special case: if zooming, fake the address\r\n            {\r\n                border *= anim_t;\r\n            }\r\n            thickBorder(x, y, w, h, border);\r\n        }\r\n    } else {\r\n        // plain quad\r\n        let colors = flip ? colors_v2_left : colors_v2_right\r\n\r\n        let visiting = getVisiting(address);\r\n        if (visiting == 0) {\r\n            ctx.fillStyle = colors[0];\r\n            ctx.fillRect(x, y, w, h);\r\n            ctx.fillStyle = colors[1];\r\n            thickBorder(x, y, w, h, w / 8);\r\n        }\r\n        if (visiting == 1) {\r\n            ctx.fillStyle = colors[1];\r\n            thickBorder(x, y, w, h, w / 8);\r\n        }\r\n    }\r\n}\r\n\r\n\r\nfunction drawTilesV3(x: number, y: number, w: number, h: number, address: number[], flip: boolean) {\r\n    if (address.length < player_address.length) {\r\n        // still bigger than the player, recurse more\r\n        let x1 = x;\r\n        let x2 = x + w / 2;\r\n        let y1 = y;\r\n        let y2 = y + h / 2;\r\n\r\n        if (flip) {\r\n            x1 = x + w / 2;\r\n            x2 = x;\r\n        }\r\n\r\n        drawTilesV3(x1, y1, w / 2, h / 2, address.concat([0]), flip);\r\n        drawTilesV3(x2, y1, w / 2, h / 2, address.concat([1]), !flip);\r\n        drawTilesV3(x2, y2, w / 2, h / 2, address.concat([2]), !flip);\r\n        drawTilesV3(x1, y2, w / 2, h / 2, address.concat([3]), flip);\r\n\r\n        if (getVisiting(address) == 0) {\r\n            // fully in the past\r\n            let colors = flip ? colors_v2_left : colors_v2_right\r\n            ctx.fillStyle = colors[1];\r\n            let border = w / 8;\r\n            if (\r\n                player_address[player_address.length - 1] == 0 // has player changed square?\r\n                && (!anim_turn ?\r\n                    getVisiting(address, prev_player_address) == 1 : // did we just visit this square?\r\n                    getVisiting(address, [0].concat(prev_player_address)) == 1)) // special case: if zooming, fake the address\r\n            {\r\n                border *= anim_t;\r\n            }\r\n            thickBorder(x, y, w, h, border);\r\n        }\r\n    } else {\r\n        // plain quad\r\n        let colors = flip ? colors_v2_left : colors_v2_right\r\n\r\n        let visiting = getVisiting(address);\r\n        if (visiting == 0) {\r\n            ctx.fillStyle = colors[0];\r\n            ctx.fillRect(x, y, w, h);\r\n            ctx.fillStyle = colors[1];\r\n            thickBorder(x, y, w, h, w / 8);\r\n        }\r\n        if (visiting == 1) {\r\n            ctx.fillStyle = colors[1];\r\n            thickBorder(x, y, w, h, w / 8);\r\n        }\r\n    }\r\n}\r\n\r\nfunction thickBorder(x: number, y: number, w: number, h: number, border: number) {\r\n    ctx.fillRect(x, y, w, border);\r\n    ctx.fillRect(x, y + h - border, w, border);\r\n    ctx.fillRect(x, y, border, h);\r\n    ctx.fillRect(x + w - border, y, border, h);\r\n}\r\n\r\nlet time_last = 0;\r\nfunction update(time_cur: number) {\r\n    twgl.resizeCanvasToDisplaySize(canvas);\r\n\r\n    let delta = (time_cur - time_last) * 0.001;\r\n    time_last = time_cur;\r\n\r\n    ctx.fillStyle = \"#4E5E5E\";\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    anim_t += delta / anim_duration;\r\n    anim_t = Math.min(1.0, anim_t);\r\n\r\n    let x = 0;\r\n    let y = 0;\r\n    let w = canvas.width;\r\n    let h = canvas.height;\r\n\r\n    if (anim_turn) {\r\n        w = lerp(w * 2, w, anim_t);\r\n        // h = lerp(h * 4, h, anim_t); // style 1: vertical\r\n        h = lerp(h * 2, h, anim_t); // style 2: squares\r\n    }\r\n\r\n    // drawTiles(x, y, w, h, [], false);\r\n    // drawTilesV2(x, y, w, h, [], false);\r\n    drawTilesV3(x, y, w, h, [], false);\r\n\r\n    // cheat\r\n    // while (cur_turn < 1023) {\r\n    //     onInput(thueMorse(cur_turn));\r\n    // }\r\n\r\n    if (pending_click) {\r\n        ctx.fillStyle = \"pink\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.textBaseline = \"middle\";\r\n        ctx.font = \"60px Arial\"\r\n        ctx.fillText(\"Click to start\", canvas.width / 2, canvas.height * 3 / 4)\r\n    }\r\n\r\n    loop_id = requestAnimationFrame(update);\r\n}\r\n","// Use objects instead of arrays: https://jsben.ch/FgKVi\r\n\r\nexport function lerp(a: number, b: number, t: number): number {\r\n    return a * (1 - t) + b * t;\r\n}\r\n\r\nexport function towards(cur: number, target: number, max_delta: number): number {\r\n    if (cur > target) {\r\n        return Math.max(cur - max_delta, target);\r\n    } else if (cur < target) {\r\n        return Math.min(cur + max_delta, target);\r\n    } else {\r\n        return target;\r\n    }\r\n}\r\n\r\nexport function clamp(value: number, min: number, max: number): number {\r\n    return Math.max(min, Math.min(max, value));\r\n}\r\n\r\nexport class Vec2 {\r\n    constructor(\r\n        public x: number = 0.0,\r\n        public y: number = 0.0,\r\n    ) { }\r\n\r\n    // scratchpad vectors, meant to be reused as intermediate values without allocation\r\n    static tmp = new Vec2(0, 0);\r\n    static tmp1 = new Vec2(0, 0);\r\n    static tmp2 = new Vec2(0, 0);\r\n    static tmp3 = new Vec2(0, 0);\r\n\r\n    static zero = new Vec2(0, 0);\r\n    static one = new Vec2(1, 1);\r\n\r\n    static copy(v: Vec2, out?: Vec2): Vec2 {\r\n        out = out || new Vec2();\r\n        out.x = v.x;\r\n        out.y = v.y;\r\n        return out;\r\n    }\r\n\r\n    static add(a: Vec2, b: Vec2, out?: Vec2): Vec2 {\r\n        out = out || new Vec2();\r\n        out.x = a.x + b.x;\r\n        out.y = a.y + b.y;\r\n        return out;\r\n    }\r\n\r\n    static sub(a: Vec2, b: Vec2, out?: Vec2): Vec2 {\r\n        out = out || new Vec2();\r\n        out.x = a.x - b.x;\r\n        out.y = a.y - b.y;\r\n        return out;\r\n    }\r\n\r\n    static negate(v: Vec2, out?: Vec2): Vec2 {\r\n        out = out || new Vec2();\r\n        out.x = -v.x;\r\n        out.y = -v.y;\r\n        return out;\r\n    }\r\n\r\n    static scale(v: Vec2, s: number, out?: Vec2): Vec2 {\r\n        out = out || new Vec2();\r\n        out.x = v.x * s;\r\n        out.y = v.y * s;\r\n        return out;\r\n    }\r\n\r\n    static lerp(a: Vec2, b: Vec2, t: number, out?: Vec2): Vec2 {\r\n        out = out || new Vec2();\r\n        out.x = a.x * (1 - t) + b.x * t;\r\n        out.y = a.y * (1 - t) + b.y * t;\r\n        return out;\r\n    }\r\n\r\n    static isZero(v: Vec2): boolean {\r\n        return v.x == 0 && v.y == 0;\r\n    }\r\n\r\n    static equals(a: Vec2, b: Vec2): boolean {\r\n        return a.x == b.x && a.y == b.y;\r\n    }\r\n\r\n    static map2(a: Vec2, b: Vec2, fn: (a: number, b: number) => number, out?: Vec2): Vec2 {\r\n        out = out || new Vec2();\r\n        out.x = fn(a.x, b.x);\r\n        out.y = fn(a.y, b.y);\r\n        return out;\r\n    }\r\n}\r\n"],"names":["$parcel$global","globalThis","self","window","global","$parcel$modules","$parcel$inits","parcelRequire","id","exports","init","module","call","err","Error","code","register","$amYBK","$5c4293b9a464b6e0$export$ac4bca90992eed1","constructor","x","y","_","tmp","_1","tmp1","_2","tmp2","_3","tmp3","_4","zero","_5","one","copy","v","out","add","a","b","sub","negate","scale","s","lerp","t","isZero","equals","map2","fn","$b7c86ab12e2a3969$var$canvas","document","querySelector","$b7c86ab12e2a3969$var$ctx","getContext","requestAnimationFrame","$b7c86ab12e2a3969$var$update","time_cur","resizeCanvasToDisplaySize","delta","$b7c86ab12e2a3969$var$time_last","fillStyle","fillRect","width","height","$b7c86ab12e2a3969$var$anim_t","Math","min","w","h","$b7c86ab12e2a3969$var$anim_turn","$b7c86ab12e2a3969$var$drawTilesV3","address","flip","length","$b7c86ab12e2a3969$var$player_address","x1","x2","y2","concat","$b7c86ab12e2a3969$var$getVisiting","colors","$b7c86ab12e2a3969$var$colors_v2_left","$b7c86ab12e2a3969$var$colors_v2_right","border","$b7c86ab12e2a3969$var$prev_player_address","$b7c86ab12e2a3969$var$thickBorder","visiting","$b7c86ab12e2a3969$var$pending_click","textAlign","textBaseline","font","fillText","addEventListener","ev","$b7c86ab12e2a3969$var$onInput","pageX","innerWidth","$b7c86ab12e2a3969$var$cur_turn","is_left","$b7c86ab12e2a3969$var$thueMorse","n","res","every","d","slice","$b7c86ab12e2a3969$var$nextAdress","result","Array","fill","k","console","log","alert","player"],"version":3,"file":"index.c4e63c74.js.map"}