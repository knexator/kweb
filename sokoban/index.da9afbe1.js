!function(){function e(e,r,t,n){Object.defineProperty(e,r,{get:t,set:n,enumerable:!0,configurable:!0})}function r(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},o={},i=t.parcelRequire94c2;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in o){var r=o[e];delete o[e];var t={id:e,exports:{}};return n[e]=t,r.call(t.exports,t,t.exports),t.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,r){o[e]=r},t.parcelRequire94c2=i),i.register("iE7OH",function(r,t){"use strict";e(r.exports,"register",function(){return n},function(e){return n=e}),e(r.exports,"resolve",function(){return o},function(e){return o=e});var n,o,i={};n=function(e){for(var r=Object.keys(e),t=0;t<r.length;t++)i[r[t]]=e[r[t]]},o=function(e){var r=i[e];if(null==r)throw Error("Could not resolve bundle with id "+e);return r}}),i.register("aNJCr",function(r,t){e(r.exports,"getBundleURL",function(){return n},function(e){return n=e});"use strict";var n,o={};n=function(e){var r=o[e];return r||(r=function(){try{throw Error()}catch(r){var e=(""+r.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return(""+e[2]).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}(),o[e]=r),r}}),i("iE7OH").register(JSON.parse('{"6XD96":"index.da9afbe1.js","dmpJf":"sprite.22ec2077.png","j20FQ":"walls_312.cb79a6c7.png","hnbg0":"floor_312.8cddc3eb.png","kzlhX":"player_puzzlescript.5728a87e.png","kYUDX":"index.a7a224eb.js"}'));var s=i("6MzNI"),a={};a="#version 300 es\n#define GLSLIFY 1\n\n// [0, 1]^2\nin vec2 a_vertex;\n\n// pixels for everything\nuniform vec2 u_resolution;\nuniform vec2 u_position;\nuniform vec2 u_size;\n\nout vec2 v_texcoord;\n\nvoid main() {\n    // if size is 100 & screen is 400, then\n    // clip space result width will be .5\n    vec2 pos = 2.0 * a_vertex * u_size / u_resolution;\n\n    // if position is 200 & screen is 400, then\n    // clip space result offset will be .5\n    pos += 2.0 * u_position / u_resolution;\n\n    // pos of 0 should go to the top left\n    pos -= vec2(1, 1);\n\n    // ypos = down\n    pos.y = -pos.y;\n\n    gl_Position = vec4(pos, 0, 1);\n\n    v_texcoord = a_vertex;\n}\n\n// todo: investigate glslify";var u={};u="#version 300 es\nprecision highp float;\n#define GLSLIFY 1\n\nin vec2 v_texcoord;\n\nuniform sampler2D u_texture;\n\nout vec4 out_color;\n\nvoid main() {\n    out_color = texture(u_texture, v_texcoord);\n}";class f{constructor(e=0,r=0){this.x=e,this.y=r}static #e=(()=>{this.zero=new f(0,0)})();static copy(e,r){return(r=r||new f).x=e.x,r.y=e.y,r}static add(e,r,t){return(t=t||new f).x=e.x+r.x,t.y=e.y+r.y,t}static sub(e,r,t){return(t=t||new f).x=e.x-r.x,t.y=e.y-r.y,t}static negate(e,r){return(r=r||new f).x=-e.x,r.y=-e.y,r}static isZero(e){return 0==e.x&&0==e.y}static map2(e,r,t,n){return(n=n||new f).x=t(e.x,r.x),n.y=t(e.y,r.y),n}}let c=document.querySelector("#c").getContext("webgl2",{alpha:!1});c.clearColor(.5,.5,.75,1),c.enable(c.BLEND),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),s.resizeCanvasToDisplaySize(c.canvas),c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);var l={};l=i("aNJCr").getBundleURL("6XD96")+"../"+i("iE7OH").resolve("dmpJf");let d=s.createTexture(c,{src:new URL(l).toString()}),p=s.createProgramInfo(c,[r(a),r(u)]),_=s.createBufferInfoFromArrays(c,{a_vertex:{data:[1,1,0,1,1,0,0,0,1,0,0,1],numComponents:2}}),v=s.createVertexArrayInfo(c,p,_),y=s.createProgramInfo(c,[`#version 300 es

    // [0, 1]^2 (in other words, a quad)
    in vec2 a_vertex;

    // per-sprite data
    in vec2 a_position;
    in vec2 a_tileindex;

    // global data
    // sprites drawn at 0,0 will end in this clipspace position
    uniform vec2 u_origin;
    // sprites drawn at 1,1 will end in u_origin plus this clipspace position
    uniform vec2 u_basis;
    // number of sprites in the spritesheet
    uniform vec2 u_sheet_count;

    out vec2 v_texcoord;

    void main() {
        gl_Position = vec4(u_origin + (a_vertex + a_position) * u_basis, 0.0, 1.0);
        v_texcoord = (a_tileindex + a_vertex) / u_sheet_count;
    }
    `,`#version 300 es
    precision highp float;
    
    in vec2 v_texcoord;

    uniform sampler2D u_sheet;

    out vec4 out_color;

    void main() {
        out_color = texture(u_sheet, v_texcoord);
    }
    `]);var x={};x=i("aNJCr").getBundleURL("6XD96")+"../"+i("iE7OH").resolve("j20FQ");let g=s.createTexture(c,{src:new URL(x).toString(),mag:c.NEAREST,wrap:c.REPEAT}),h=`
####!!
#.O#!!
#..###
#@P..#
#..*.#
#..###
####!!
`.trim(),m=h.split("\n").map(e=>e.trim()),A=m.length,b=m[0].length;console.assert(m.every(e=>e.length==b),"Bad ascii level");let w=m.map(e=>e.split("").map(e=>"#"==e)).flat();function R(e,r){return!(e<0)&&!(e>=b)&&!(r<0)&&!(r>=A)&&w[e+r*b]}let F=b+1,E=A+1,B=new Float32Array(4*F*E);for(let e=0;e<E;e++)for(let r=0;r<F;r++){let t=(r+e*F)*4;B[t+0]=r,B[t+1]=e;let n=function(e,r){let t=R(e-0,r-1)?1:0,n=R(e-0,r-0)?2:0,o=R(e-1,r-0)?4:0;return[[0,3],[0,2],[1,3],[1,0],[0,0],[2,3],[3,0],[1,1],[3,3],[1,2],[0,1],[2,2],[3,2],[3,1],[2,0],[2,1]][(R(e-1,r-1)?8:0)+t+o+n]}(r,e);B[t+2]=n[0],B[t+3]=n[1]}let T=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,T),c.bufferData(c.ARRAY_BUFFER,B,c.STATIC_DRAW);let S=s.createVertexArrayInfo(c,y,s.createBufferInfoFromArrays(c,{a_position:{buffer:T,type:c.FLOAT,numComponents:2,stride:16,offset:0,divisor:1},a_tileindex:{buffer:T,type:c.FLOAT,numComponents:2,stride:16,offset:8,divisor:1},a_vertex:{data:[1,1,0,1,1,0,0,0,1,0,0,1],numComponents:2}}));var L={};L=i("aNJCr").getBundleURL("6XD96")+"../"+i("iE7OH").resolve("hnbg0");let C=s.createTexture(c,{src:new URL(L).toString(),mag:c.NEAREST,wrap:c.REPEAT}),U=m.map(e=>e.split("").map(e=>"#"!=e&&"!"!=e)).flat(),I=new Float32Array(4*b*A),O=0;for(let e=0;e<A;e++)for(let r=0;r<b;r++)U[r+e*b]&&(I[4*O+0]=r,I[4*O+1]=e,B[4*O+2]=0,B[4*O+3]=0,O+=1);let D=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,D),c.bufferData(c.ARRAY_BUFFER,I,c.STATIC_DRAW);let H=s.createVertexArrayInfo(c,y,s.createBufferInfoFromArrays(c,{a_position:{buffer:D,type:c.FLOAT,numComponents:2,stride:16,offset:0,divisor:1},a_tileindex:{buffer:D,type:c.FLOAT,numComponents:2,stride:16,offset:8,divisor:1},a_vertex:{data:[1,1,0,1,1,0,0,0,1,0,0,1],numComponents:2}}));var N=0,z=new Float32Array(128);let P=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,P),c.bufferData(c.ARRAY_BUFFER,z,c.DYNAMIC_DRAW);let k=s.createVertexArrayInfo(c,y,s.createBufferInfoFromArrays(c,{a_position:{buffer:P,type:c.FLOAT,numComponents:2,stride:16,offset:0,divisor:1},a_tileindex:{buffer:P,type:c.FLOAT,numComponents:2,stride:16,offset:8,divisor:1},a_vertex:{data:[1,1,0,1,1,0,0,0,1,0,0,1],numComponents:2}}));var Y={};Y=i("aNJCr").getBundleURL("6XD96")+"../"+i("iE7OH").resolve("kzlhX");let q=s.createTexture(c,{src:new URL(Y).toString(),mag:c.NEAREST,wrap:c.REPEAT}),j={debug_x:0,debug_y:0,player_pos:new f(2,3)},J={player_offset:new f(0,0)},K=N;N+=1,z[4*K+0]=j.player_pos.x,z[4*K+1]=j.player_pos.y,z[4*K+2]=0,z[4*K+3]=0;let X={pressed:{},queued:[]};requestAnimationFrame(function e(r){let t=(r-M)*.001;if(M=r,s.resizeCanvasToDisplaySize(c.canvas)&&c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight),X.pressed.KeyA&&(j.debug_x-=1),X.pressed.KeyD&&(j.debug_x+=1),X.pressed.KeyW&&(j.debug_y-=1),X.pressed.KeyS&&(j.debug_y+=1),X.queued.length>0&&f.isZero(J.player_offset)){let e=X.queued.shift(),r=new f;switch(e){case"KeyD":r.x=1;break;case"KeyA":r.x=-1;break;case"KeyW":r.y=-1;break;case"KeyS":r.y=1}if(0!=r.x||0!=r.y){let e=f.add(j.player_pos,r);R(e.x,e.y)||(f.copy(e,j.player_pos),f.sub(J.player_offset,r,J.player_offset))}}f.isZero(J.player_offset)||(f.map2(J.player_offset,f.zero,(e,r)=>{var n;return n=t/.05,e>r?Math.max(e-n,r):e<r?Math.min(e+n,r):r},J.player_offset),z[4*K+0]=j.player_pos.x+J.player_offset.x,z[4*K+1]=j.player_pos.y+J.player_offset.y),c.clear(c.COLOR_BUFFER_BIT),c.useProgram(p.program),s.setBuffersAndAttributes(c,p,v),s.setUniforms(p,{u_texture:d,u_resolution:[c.canvas.width,c.canvas.height],u_size:[50,50],u_position:[j.debug_x,j.debug_y]}),s.drawBufferInfo(c,_),c.useProgram(y.program),c.bindVertexArray(S.vertexArrayObject),s.setUniformsAndBindTextures(y,{u_origin:[-(64*F)/c.canvas.width,64*E/c.canvas.height],u_basis:[128/c.canvas.width,-128/c.canvas.height],u_sheet_count:[4,4],u_sheet:g}),c.drawArraysInstanced(c.TRIANGLES,0,6,F*E),c.bindVertexArray(H.vertexArrayObject),s.setUniformsAndBindTextures(y,{u_origin:[-(64*b)/c.canvas.width,64*A/c.canvas.height],u_basis:[128/c.canvas.width,-128/c.canvas.height],u_sheet_count:[1,1],u_sheet:C}),c.drawArraysInstanced(c.TRIANGLES,0,6,O),c.bindBuffer(c.ARRAY_BUFFER,P),c.bufferSubData(c.ARRAY_BUFFER,0,z),c.bindVertexArray(k.vertexArrayObject),s.setUniformsAndBindTextures(y,{u_origin:[-(64*b)/c.canvas.width,64*A/c.canvas.height],u_basis:[128/c.canvas.width,-128/c.canvas.height],u_sheet_count:[1,1],u_sheet:q}),c.drawArraysInstanced(c.TRIANGLES,0,6,N),requestAnimationFrame(e)}),document.addEventListener("keydown",function(e){console.log("keydown"),X.pressed[e.code]=!0,X.queued.push(e.code)}),document.addEventListener("keyup",function(e){console.log("keyup"),X.pressed[e.code]=!1});let M=0}();
//# sourceMappingURL=index.da9afbe1.js.map
